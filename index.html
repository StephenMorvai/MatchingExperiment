<!DOCTYPE html>
<html>

<body onload = "run();">

	<div id = gameArea>
		<div id = box>
			
		</div>
		<h3 id = score>Score: 0</h3>
	</div>

</body>

</html>

<style>
*{
	position:absolute;
}


#gameArea{

	width:800px;
	height:600px;
	
	margin-Left:0px;
	margin-Top:0px;
	
	background-color: #25f777;

}

#box{
	width:550px;
	height:550px;
	
	margin-Left:125px;
	margin-Top:25px;
	
	background-color: #25f711;
}


</style>

<script>

    var size = 10;
	var goal = 3;
	var jewels = 9;
	var tiles = [];
	var changes = [];
	var score = 0;
	var repeat;
	var previousClick = -1;



var cursorX;
var cursorY;
document.onmousemove = function(e){
    cursorX = e.pageX;
    cursorY = e.pageY;
}

var moveDiv = function(elem,x,y){
	elem.style.marginLeft = x + "px";
	elem.style.marginTop = y + "px";
}
var displayDiv = function(elem){
	elem.style.display = "block";
}
var hideDiv = function(elem){
	elem.style.display = "none";
}

var createDiv = function(id,w,h,x,y,col){
	document.body.appendChild(id);
	id.style.position = "absolute";
	id.style.width = w + "px";
	id.style.height = h + "px";
	id.style.marginLeft = x + "px";
	id.style.marginTop = y + "px";
	id.style.backgroundColor = col;
}

var findLinks = function(){
	for( var i = 0; i <= size - goal; i++){
		for( var j = 0; j <= size - goal ; j++){
			
			var cond = true;
			for(var k = 1; k < goal; k++){
				if(tiles[i*size + j].innerHTML != tiles[(i+k)*size + j].innerHTML){
					cond = false;
				}
			}
			if(cond){
				for(var k = 0; k < goal; k++){
					tiles[(i+k)*size + j].style.backgroundColor = "#FF2222";
					changes[(i+k)*size + j] = 1;
				}
				score++;
			}
			
			cond = true;
			for(var k = 1; k < goal; k++){
				if(tiles[i*size + j].innerHTML != tiles[i*size + j + k].innerHTML){
					cond = false;
				}
			}
			if(cond){
				for(var k = 0; k < goal; k++){
					tiles[i*size + j + k].style.backgroundColor = "#FF2222";
					changes[i*size + j + k] = 1;
				}
				score++;
			}
			
		}
	}
	return score;
}

var updateBoard = function(){
	for( var i = 0; i < size; i++){
		for( var j = 0; j < size; j++){
			if(changes[i*size + j] == 1){
				tiles[i*size + j].style.backgroundColor = "#00DA55";
				tiles[i*size + j].innerHTML  = Math.floor(Math.random() * jewels);
				changes[i*size + j] = 0;
			}
		}
	}
	processBoard(1);
}

var processBoard = function(count){
	if(count==0){
		document.getElementById("score").innerHTML = "Score: " + findLinks();
		repeat = setInterval(updateBoard,1000);
	}else{
		clearInterval(repeat);
	}
}

var isTouching = function(a,b){
	if(a%size > 0){
		if(a-1 == b){
			return true;
		}
	}
	if(a%size < size - 1){
		if(a+1 == b){
			return true;
		}
	}
	if(a >= size){
		if(a-size == b){
			return true;
		}
	}
	if(a < size*(size - 1)){
		if(a+size == b){
			return true;
		}
	}
	
	return false;
}

var click = function(){
	if(clickedOn(cursorY,50) == -1 || clickedOn(cursorX,150) == -1){
		tiles[previousClick].style.backgroundColor = "#00DA55";
		previousClick = -1;
	}else{
		num = clickedOn(cursorY,50)*size + clickedOn(cursorX,150);
		
		if(previousClick === -1){
			previousClick = num;
			tiles[num].style.backgroundColor = "#FFFF22";
		}else if(isTouching(num,previousClick)){
			tiles[num].style.backgroundColor = "#00DA55";
			tiles[previousClick].style.backgroundColor = "#00DA55";
			previousClick = -1;
			//switchTiles();
		}else{
			tiles[num].style.backgroundColor = "#00DA55";
			tiles[previousClick].style.backgroundColor = "#00DA55";
			previousClick = -1;
		}
	}
	
	
}

/**
Determines which tile was clickedOn
Only for one dimension
To determine the excat one this should be 
repeated for both mouse X and mouse Y
*/
var clickedOn = function(mos,offset){
    for(var i = 0; i < size; i++){
        if(mos > i*500/size + offset && mos < (i+1)*500/size + offset){
            return i;
        } 
    }
	return -1;
}

var run = function(){

	document.body.onclick = function() {click()};

	for( var i = 0; i < size; i++){
		for( var j = 0; j < size; j++){
			tiles[i*size + j] = document.createElement("div");
			createDiv(tiles[i*size + j], 500/size ,500/size,(500/size)*j + 150,(500/size)*i + 50,"#00DA55");
			displayDiv(tiles[i*size+j]);
			tiles[i*size + j].style.border = "2px solid";
			tiles[i*size + j].innerHTML  = Math.floor(Math.random() * jewels);
			tiles[i*size + j].style.textAlign = "center";
			tiles[i*size + j].style.lineHeight = 500/size + "px";
			changes[i*size + j] = 0;
		}
	}

		processBoard(0);
		
		//body.onclick = function(){click()};

}


</script>